/*
SQLyog Community v10.3 
MySQL - 5.5.24-log : Database - comulien
*********************************************************************
*/


/*!40101 SET NAMES utf8 */;

/*!40101 SET SQL_MODE=''*/;

/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;
CREATE DATABASE /*!32312 IF NOT EXISTS*/`comulien` /*!40100 DEFAULT CHARACTER SET latin1 */;

USE `comulien`;

/*Table structure for table `promouvoir` */

DROP TABLE IF EXISTS `promouvoir`;

CREATE TABLE `promouvoir` (
  `IDMESSAGE` BIGINT(4) NOT NULL,
  `IDUSER` BIGINT(4) NOT NULL,
  `EVALUATION` CHAR(32) DEFAULT NULL,
  PRIMARY KEY (`IDMESSAGE`,`IDUSER`),
  KEY `FK_PROMOUVOIR_USER` (`IDUSER`),
  CONSTRAINT `promouvoir_ibfk_2` FOREIGN KEY (`IDUSER`) REFERENCES `user` (`IDUSER`),
  CONSTRAINT `promouvoir_ibfk_1` FOREIGN KEY (`IDMESSAGE`) REFERENCES `message` (`IDMESSAGE`)
) ENGINE=INNODB DEFAULT CHARSET=latin1;

/*Data for the table `promouvoir` */

/*Table structure for table `privilegier` */

DROP TABLE IF EXISTS `privilegier`;

CREATE TABLE `privilegier` (
  `IDUSER` BIGINT(4) NOT NULL,
  `IDROLE` BIGINT(4) NOT NULL,
  `IDORGA` BIGINT(4) NOT NULL,
  PRIMARY KEY (`IDUSER`,`IDROLE`,`IDORGA`),
  KEY `FK_privilegier_ROLE` (`IDROLE`),
  KEY `FK_privilegier_ORGANISME` (`IDORGA`),
  CONSTRAINT `privilegier_ibfk_3` FOREIGN KEY (`IDORGA`) REFERENCES `organisme` (`IDORGA`),
  CONSTRAINT `privilegier_ibfk_1` FOREIGN KEY (`IDUSER`) REFERENCES `user` (`IDUSER`),
  CONSTRAINT `privilegier_ibfk_2` FOREIGN KEY (`IDROLE`) REFERENCES `role` (`IDROLE`)
) ENGINE=INNODB DEFAULT CHARSET=latin1;

/*Data for the table `privilegier` */

/*Table structure for table `evenement` */

DROP TABLE IF EXISTS `evenement`;

CREATE TABLE `evenement` (
  `IDEVENT` BIGINT(4) NOT NULL AUTO_INCREMENT,
  `TITREEVENT` VARCHAR(100) NOT NULL,
  `LBLEVENT` VARCHAR(255) NOT NULL,
  `IDORGA` BIGINT(4) NOT NULL,
  `DATEDEBUT` DATETIME DEFAULT NULL,
  `DATEFIN` DATETIME DEFAULT NULL,
  `DELAIPERSISTENCE` BIGINT(4) DEFAULT 0 NULL,
  `LOGO` CHAR(32) DEFAULT 'logo_defaut.png',
  PRIMARY KEY (`IDEVENT`),
  KEY `FK_EVENEMENT_ORGANISME` (`IDORGA`),
  CONSTRAINT `evenement_ibfk_1` FOREIGN KEY (`IDORGA`) REFERENCES `organisme` (`IDORGA`)
) ENGINE=INNODB DEFAULT CHARSET=latin1;

/*Data for the table `evenement` */

/*Table structure for table `message` */

DROP TABLE IF EXISTS `message`;

CREATE TABLE `message` (
  `IDMESSAGE` BIGINT(4) NOT NULL AUTO_INCREMENT,
  `IDUSER` BIGINT(4) NOT NULL,
  `IDTYPEMSG` CHAR(32) NOT NULL,
  `IDMESSAGE_REPONDRE` BIGINT(4) DEFAULT NULL,
  `IDUSER_EMETTRE` BIGINT(4) NOT NULL,
  `IDEVENT` BIGINT(4) NOT NULL,
  `LBLMESSAGE` VARCHAR(255) DEFAULT NULL,
  `DATEEMISSION` DATETIME DEFAULT NULL,
  `DATELIMITE` DATETIME DEFAULT NULL,
  `ESTACTIFMSG` BOOLEAN DEFAULT TRUE,
  PRIMARY KEY (`IDMESSAGE`),
  KEY `FK_MESSAGE_USER` (`IDUSER`),
  KEY `FK_MESSAGE_TYPEMESSAGE` (`IDTYPEMSG`),
  KEY `FK_MESSAGE_MESSAGE` (`IDMESSAGE_REPONDRE`),
  KEY `FK_MESSAGE_USER1` (`IDUSER_EMETTRE`),
  KEY `FK_MESSAGE_EVENEMENT` (`IDEVENT`),
  CONSTRAINT `message_ibfk_5` FOREIGN KEY (`IDEVENT`) REFERENCES `evenement` (`IDEVENT`),
  CONSTRAINT `message_ibfk_1` FOREIGN KEY (`IDUSER`) REFERENCES `user` (`IDUSER`),
  CONSTRAINT `message_ibfk_2` FOREIGN KEY (`IDTYPEMSG`) REFERENCES `typemessage` (`IDTYPEMSG`),
  CONSTRAINT `message_ibfk_3` FOREIGN KEY (`IDMESSAGE_REPONDRE`) REFERENCES `message` (`IDMESSAGE`),
  CONSTRAINT `message_ibfk_4` FOREIGN KEY (`IDUSER_EMETTRE`) REFERENCES `user` (`IDUSER`)
) ENGINE=INNODB DEFAULT CHARSET=latin1;

/*Data for the table `message` */

/*Table structure for table `organisme` */

DROP TABLE IF EXISTS `organisme`;

CREATE TABLE `organisme` (
  `IDORGA` BIGINT(4) NOT NULL AUTO_INCREMENT,
  `NOMORGA` VARCHAR(128) DEFAULT NULL,
  PRIMARY KEY (`IDORGA`)
) ENGINE=INNODB DEFAULT CHARSET=latin1;

/*Data for the table `organisme` */


/*Table structure for table `role` */

DROP TABLE IF EXISTS `role`;

CREATE TABLE `role` (
  `IDROLE` BIGINT(4) NOT NULL,
  `LBLROLE` VARCHAR(128) DEFAULT NULL,
  `TYPEROLE` BIGINT(4) DEFAULT NULL,
  `IMAGEROLE` VARCHAR(255) DEFAULT NULL,
  PRIMARY KEY (`IDROLE`)
) ENGINE=INNODB DEFAULT CHARSET=latin1;

/*Data for the table `role` */

INSERT  INTO `role`(`IDROLE`,`LBLROLE`,`TYPEROLE`,`IMAGEROLE`) VALUES (0,'Administrateur',NULL,NULL),(1,'Mod√©rateur',NULL,NULL),(2,'Organisateur',NULL,NULL),(3,'Superviseur',NULL,NULL);

/*Table structure for table `typemessage` */

DROP TABLE IF EXISTS `typemessage`;

CREATE TABLE `typemessage` (
  `IDTYPEMSG` CHAR(32) NOT NULL,
  `TYPEMSG` VARCHAR(128) DEFAULT NULL,
  PRIMARY KEY (`IDTYPEMSG`)
) ENGINE=INNODB DEFAULT CHARSET=latin1;

/*Data for the table `typemessage` */
insert into typemessage values (0,'Divers');
/*Table structure for table `user` */

DROP TABLE IF EXISTS `user`;

CREATE TABLE `user` (
  `IDUSER` BIGINT(4) NOT NULL AUTO_INCREMENT,
  `LOGIN` VARCHAR(128) NOT NULL,
  `PASSWORD` VARCHAR(128) NOT NULL,
  `EMAIL` VARCHAR(128) NOT NULL,
  `NBMESSAGE` BIGINT(4) DEFAULT 0,
  `NBOK` BIGINT(4) DEFAULT 0,
  `DATEINSCRIPTION` DATETIME NOT NULL,
  `ESTACTIFUSER` BOOLEAN DEFAULT TRUE,
  PRIMARY KEY (`IDUSER`)
) ENGINE=INNODB DEFAULT CHARSET=latin1;

DROP TABLE IF EXISTS `apprecier`;
CREATE TABLE `apprecier` (
   IDMESSAGE BIGINT(4) NOT NULL  ,
   IDUSER BIGINT(4) NOT NULL  ,
   EVALUATION BIGINT(4) NOT NULL  ,
   PRIMARY KEY (IDMESSAGE,IDUSER),
   CONSTRAINT `apprecier_ibfk_1` FOREIGN KEY (`IDMESSAGE`) REFERENCES `message` (`IDMESSAGE`),
  CONSTRAINT `apprecier_ibfk_2` FOREIGN KEY (`IDUSER`) REFERENCES `user` (`IDUSER`) 
 ) ;
/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;


